<!doctype html>
<html lang="fa" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>فروشگاه آنلاین الماس شرق</title>
  
  <!-- Firebase SDK -->
  <script type="module" src="./firebase-config.js"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Vazir', 'Tahoma', sans-serif;
        }
        
        .product-card {
            transition: all 0.3s ease;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .admin-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(238, 90, 36, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(9, 132, 227, 0.4);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            backdrop-filter: blur(15px);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: linear-gradient(135deg, #00b894, #00a085);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #e17055, #d63031);
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 400px;
        }
        
        .filter-chip {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-chip:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }
        
        .filter-chip.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-color: #ff6b6b;
            color: white;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            color: white;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .flash-sale {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
        }
        
        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .countdown-item {
            text-align: center;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .countdown-number {
            font-size: 24px;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .countdown-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .newsletter-section {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            color: white;
        }
        
        .trust-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .trust-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 15px;
        }
        
        .trust-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #28a745, #20c997);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .trust-text {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }
        
        .social-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .social-icon:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .instagram { background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); }
        .telegram { background: linear-gradient(135deg, #0088cc, #0066aa); }
        .whatsapp { background: linear-gradient(135deg, #25d366, #128c7e); }
        .email { background: linear-gradient(135deg, #ea4335, #d33b2c); }
        
        .notification-bar {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            position: relative;
        }
        
        .notification-close {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
        }
        
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .user-menu {
            position: relative;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-width: 200px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .breadcrumb-nav {
            background: #f8f9fa;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .breadcrumb-list {
            display: flex;
            align-items: center;
            gap: 8px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .breadcrumb-link {
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
        }
        
        .breadcrumb-link:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            color: #6c757d;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 40px;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            background: #f8f9fa;
        }
        
        .pagination button.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-color: #ff6b6b;
            color: white;
        }
        
        @media (max-width: 768px) {
            .product-card {
                margin-bottom: 20px;
            }
            
            .hero-section {
                min-height: 300px;
                padding: 40px 0;
            }
            
            .filter-chip {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            .modal .bg-white {
                margin: 10px;
                max-height: 95vh;
            }
            
            .search-container {
                max-width: 200px;
            }
            
            .countdown-timer {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .countdown-item {
                flex: 1;
                min-width: 80px;
            }
            
            .trust-badges {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .hero-section h2 {
                font-size: 28px;
            }
            
            .hero-section p {
                font-size: 16px;
            }
            
            .filter-chip {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .product-card .p-5 {
                padding: 15px;
            }
            
            .modal .bg-white {
                border-radius: 0;
                height: 100vh;
                max-height: 100vh;
            }
            
            .search-container {
                display: none;
            }
        }
    </style>
 </head>
 <body class="bg-gray-50">
  <!-- Notification Bar -->
  <div id="notification-bar" class="notification-bar">
   <span>🎉 تخفیف ویژه! تا ۵۰٪ تخفیف روی محصولات منتخب</span>
   <button class="notification-close" onclick="closeNotificationBar()">×</button>
  </div>

  <!-- Header -->
  <header class="sticky-header bg-white shadow-lg">
   <div class="container mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
     <div class="flex items-center space-x-4 space-x-reverse">
      <div class="flex items-center space-x-2 space-x-reverse">
       <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center">
        <i class="fas fa-gem text-white"></i>
       </div>
       <div>
        <h1 id="store-title" class="text-2xl font-bold text-gray-800">الماس شرق</h1>
        <p id="store-tagline" class="text-sm text-gray-600">بهترین کیفیت، بهترین قیمت</p>
       </div>
      </div>
     </div>

     <!-- Search Bar -->
     <div class="search-container flex-1 max-w-md mx-8">
      <div class="relative">
       <input type="text" id="search-input" placeholder="جستجوی محصولات..." class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-full focus:ring-2 focus:ring-orange-500 focus:border-transparent">
       <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
      </div>
      <div id="search-results" class="search-results hidden"></div>
     </div>

     <div class="flex items-center space-x-4 space-x-reverse">
      <!-- User Account -->
      <div class="user-menu">
       <button id="user-btn" class="flex items-center space-x-2 space-x-reverse text-gray-700 hover:text-orange-600 transition-colors">
        <i class="fas fa-user"></i>
        <span id="user-status">ورود / ثبت نام</span>
       </button>
       <div id="user-dropdown" class="user-dropdown hidden">
        <div id="login-section" class="p-4">
         <button id="login-btn" class="w-full btn-secondary text-white py-2 rounded-lg font-bold mb-2">ورود به حساب</button>
         <button id="register-btn" class="w-full border border-blue-500 text-blue-500 py-2 rounded-lg font-bold">ثبت نام</button>
        </div>
       </div>
      </div>

      <!-- Shopping Cart -->
      <button id="cart-btn" class="relative text-gray-700 hover:text-orange-600 transition-colors">
       <i class="fas fa-shopping-cart text-xl"></i>
       <span id="cart-count" class="notification-badge hidden">0</span>
      </button>

      <!-- Admin Panel -->
      <button id="admin-btn" class="btn-primary text-white px-6 py-2 rounded-lg font-bold">
       <i class="fas fa-cog ml-2"></i> پنل مدیریت
      </button>
     </div>
    </div>
   </div>
  </header>

  <!-- Hero Section -->
  <section class="hero-section text-white">
   <div class="container mx-auto px-4 py-16 text-center">
    <h2 id="welcome-message" class="text-4xl font-bold mb-4">به فروشگاه الماس شرق خوش آمدید</h2>
    <p class="text-xl mb-8 opacity-90">مجموعه‌ای از بهترین محصولات مد و زیبایی</p>
    <div class="flex justify-center gap-4 mb-8">
     <button onclick="scrollToProducts()" class="btn-secondary text-white px-8 py-3 rounded-full font-bold text-lg">
      <i class="fas fa-arrow-down ml-2"></i> مشاهده محصولات
     </button>
     <button onclick="openCartModal()" class="bg-white text-purple-600 px-8 py-3 rounded-full font-bold text-lg hover:bg-gray-100 transition-colors">
      <i class="fas fa-shopping-cart ml-2"></i> سبد خرید
     </button>
    </div>

    <!-- Hero Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
     <div class="stats-card">
      <div class="text-3xl font-bold mb-2" id="total-products-hero">0</div>
      <div class="text-sm opacity-90">محصول متنوع</div>
     </div>
     <div class="stats-card">
      <div class="text-3xl font-bold mb-2">24/7</div>
      <div class="text-sm opacity-90">پشتیبانی آنلاین</div>
     </div>
     <div class="stats-card">
      <div class="text-3xl font-bold mb-2">1000+</div>
      <div class="text-sm opacity-90">مشتری راضی</div>
     </div>
    </div>
   </div>
  </section>

  <!-- Features Section -->
  <section class="py-16 bg-white">
   <div class="container mx-auto px-4">
    <h3 class="text-3xl font-bold text-center mb-12 text-gray-800">چرا الماس شرق؟</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
     <div class="feature-card">
      <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
       <i class="fas fa-shipping-fast text-2xl text-white"></i>
      </div>
      <h4 class="text-xl font-bold mb-4 text-gray-800">ارسال سریع</h4>
      <p class="text-gray-600">ارسال رایگان برای خریدهای بالای ۵۰۰ هزار تومان</p>
     </div>
     <div class="feature-card">
      <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
       <i class="fas fa-shield-alt text-2xl text-white"></i>
      </div>
      <h4 class="text-xl font-bold mb-4 text-gray-800">ضمانت کیفیت</h4>
      <p class="text-gray-600">تضمین اصالت و کیفیت تمامی محصولات</p>
     </div>
     <div class="feature-card">
      <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
       <i class="fas fa-headset text-2xl text-white"></i>
      </div>
      <h4 class="text-xl font-bold mb-4 text-gray-800">پشتیبانی ۲۴/۷</h4>
      <p class="text-gray-600">پشتیبانی آنلاین در تمام ساعات شبانه‌روز</p>
     </div>
    </div>
   </div>
  </section>

  <!-- Flash Sale Section -->
  <section class="py-12">
   <div class="container mx-auto px-4">
    <div class="flash-sale">
     <h3 class="text-3xl font-bold mb-4">⚡ فروش ویژه امروز</h3>
     <p class="text-xl mb-6">تا ۵۰٪ تخفیف روی محصولات منتخب</p>
     <div class="countdown-timer">
      <div class="countdown-item">
       <div class="countdown-number" id="hours">12</div>
       <div class="countdown-label">ساعت</div>
      </div>
      <div class="countdown-item">
       <div class="countdown-number" id="minutes">34</div>
       <div class="countdown-label">دقیقه</div>
      </div>
      <div class="countdown-item">
       <div class="countdown-number" id="seconds">56</div>
       <div class="countdown-label">ثانیه</div>
      </div>
     </div>
     <button onclick="scrollToProducts()" class="bg-white text-red-500 px-8 py-3 rounded-full font-bold text-lg hover:bg-gray-100 transition-colors mt-6">
      مشاهده محصولات تخفیف‌دار
     </button>
    </div>
   </div>
  </section>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8" id="products-section">
   <!-- Breadcrumb -->
   <nav class="breadcrumb-nav">
    <div class="container mx-auto px-4">
     <ol class="breadcrumb-list">
      <li class="breadcrumb-item">
       <a href="#" class="breadcrumb-link" onclick="updateURL('home')">خانه</a>
      </li>
      <li class="breadcrumb-item">
       <span class="breadcrumb-separator">/</span>
       <span>محصولات</span>
      </li>
     </ol>
    </div>
   </nav>

   <!-- Categories -->
   <div class="mb-8">
    <div class="text-center mb-6">
     <h2 class="text-2xl font-bold text-gray-800">دسته‌بندی محصولات</h2>
     <p id="product-count" class="text-gray-600 mt-2">
      <i class="fas fa-box text-blue-500 ml-1"></i>
      <span id="total-products">0</span> محصول موجود
     </p>
    </div>
    <div class="flex flex-wrap justify-center gap-4">
     <button class="filter-chip active" data-category="all" onclick="filterProducts('all')">
      <i class="fas fa-th-large ml-2"></i> همه محصولات
     </button>
     <button class="filter-chip" data-category="لباس" onclick="filterProducts('لباس')">
      <i class="fas fa-tshirt ml-2"></i> لباس
     </button>
     <button class="filter-chip" data-category="آرایش" onclick="filterProducts('آرایش')">
      <i class="fas fa-palette ml-2"></i> لوازم آرایش
     </button>
     <button class="filter-chip" data-category="مراقبت" onclick="filterProducts('مراقبت')">
      <i class="fas fa-spa ml-2"></i> مراقبت پوست
     </button>
     <button class="filter-chip" data-category="عطر" onclick="filterProducts('عطر')">
      <i class="fas fa-spray-can ml-2"></i> عطر و ادکلن
     </button>
    </div>
   </div>

   <!-- Products Grid -->
   <div id="products-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
    <!-- Products will be loaded here -->
   </div>

   <!-- Pagination -->
   <div class="pagination" id="pagination">
    <!-- Pagination buttons will be generated here -->
   </div>

   <!-- Empty State -->
   <div id="empty-state" class="text-center py-20 hidden">
    <div class="text-8xl mb-6">🛍️</div>
    <h3 class="text-2xl font-bold text-gray-600 mb-4">هنوز محصولی اضافه نشده</h3>
    <p class="text-gray-500 mb-6">از پنل مدیریت محصولات جدید اضافه کنید</p>
    <button onclick="document.getElementById('admin-btn').click()" class="btn-primary text-white px-8 py-3 rounded-lg font-bold">
     <i class="fas fa-plus ml-2"></i> افزودن محصول اول
    </button>
   </div>
  </main>

  <!-- Newsletter Section -->
  <section class="py-12">
   <div class="container mx-auto px-4">
    <div class="newsletter-section">
     <h3 class="text-3xl font-bold mb-4">عضویت در خبرنامه</h3>
     <p class="text-xl mb-6">از جدیدترین محصولات و تخفیف‌های ویژه باخبر شوید</p>
     <form class="flex flex-col md:flex-row gap-4 max-w-md mx-auto" onsubmit="subscribeNewsletter(event)">
      <input type="email" placeholder="ایمیل خود را وارد کنید" class="flex-1 px-4 py-3 rounded-lg text-gray-800" required>
      <button type="submit" class="bg-white text-red-500 px-8 py-3 rounded-lg font-bold hover:bg-gray-100 transition-colors">عضویت</button>
     </form>
    </div>
   </div>
  </section>

  <!-- Trust Badges -->
  <section class="py-12 bg-gray-50">
   <div class="container mx-auto px-4">
    <div class="trust-badges">
     <div class="trust-badge">
      <div class="trust-icon"><i class="fas fa-lock"></i></div>
      <div class="trust-text">پرداخت امن</div>
     </div>
     <div class="trust-badge">
      <div class="trust-icon"><i class="fas fa-truck"></i></div>
      <div class="trust-text">ارسال سریع</div>
     </div>
     <div class="trust-badge">
      <div class="trust-icon"><i class="fas fa-undo"></i></div>
      <div class="trust-text">ضمانت بازگشت</div>
     </div>
     <div class="trust-badge">
      <div class="trust-icon"><i class="fas fa-headset"></i></div>
      <div class="trust-text">پشتیبانی ۲۴/۷</div>
     </div>
    </div>
   </div>
  </section>

  <!-- Comments & Suggestions Section -->
  <section class="bg-white py-12 mt-12">
   <div class="container mx-auto px-4">
    <div class="max-w-2xl mx-auto">
     <h3 class="text-2xl font-bold text-center mb-8 text-gray-800">
      <i class="fas fa-comments text-blue-500 ml-2"></i> نظرات و پیشنهادات
     </h3>
     <div class="bg-gray-50 p-6 rounded-xl">
      <form id="feedback-form" class="space-y-4" onsubmit="submitFeedback(event)">
       <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">نام شما</label>
        <input type="text" id="feedback-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="نام خود را وارد کنید" required>
       </div>
       <div>
        <label class="block text-sm font-bold text-gray-700 mb-2">نظر یا پیشنهاد شما</label>
        <textarea id="feedback-message" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="4" placeholder="نظر یا پیشنهاد خود را بنویسید..." required></textarea>
       </div>
       <button type="submit" id="feedback-btn" class="w-full btn-secondary text-white py-3 rounded-lg font-bold flex items-center justify-center">
        <span class="loading-spinner hidden ml-2"></span>
        <i class="fas fa-paper-plane ml-2"></i> ارسال نظر
       </button>
      </form>
     </div>
    </div>
   </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-12 mt-12">
   <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
     <div>
      <h4 class="text-lg font-bold mb-4"><i class="fas fa-gem text-orange-500 ml-2"></i> الماس شرق</h4>
      <p class="text-gray-300 mb-4">فروشگاه آنلاین مد و زیبایی با بهترین کیفیت و قیمت</p>
      <div class="flex gap-3">
       <a href="#" class="social-icon instagram"><i class="fab fa-instagram"></i></a>
       <a href="http://t.me/rahmatedit" target="_blank" rel="noopener noreferrer" class="social-icon telegram"><i class="fab fa-telegram"></i></a>
       <a href="#" class="social-icon whatsapp"><i class="fab fa-whatsapp"></i></a>
       <a href="mailto:Enayatollaharashi@gmail.com" class="social-icon email"><i class="fas fa-envelope"></i></a>
      </div>
     </div>
     <div>
      <h4 class="text-lg font-bold mb-4"><i class="fas fa-phone text-green-500 ml-2"></i> راه‌های ارتباطی</h4>
      <div class="space-y-2">
       <p class="text-gray-300"><i class="fas fa-envelope ml-2"></i> <span id="footer-email">Enayatollaharashi@gmail.com</span></p>
       <p class="text-gray-300"><i class="fab fa-instagram ml-2"></i> <span id="footer-instagram">@almas_Sharq.af</span></p>
       <p class="text-gray-300"><i class="fab fa-telegram ml-2"></i> پشتیبانی: <a href="http://t.me/rahmatedit" target="_blank" rel="noopener noreferrer" id="footer-telegram" class="text-blue-400 hover:text-blue-300">@rahmatedit</a></p>
      </div>
     </div>
     <div>
      <h4 class="text-lg font-bold mb-4"><i class="fas fa-info-circle text-blue-500 ml-2"></i> درباره ما</h4>
      <p class="text-gray-300">ما در الماس شرق با ارائه بهترین محصولات مد و زیبایی، سعی در رضایت مشتریان عزیز داریم.</p>
     </div>
     <div>
      <h4 class="text-lg font-bold mb-4"><i class="fas fa-shield-alt text-purple-500 ml-2"></i> امنیت و اعتماد</h4>
      <div class="space-y-2">
       <div class="flex items-center gap-2">
        <i class="fas fa-certificate text-green-500"></i>
        <span>مجوز رسمی</span>
       </div>
       <div class="flex items-center gap-2">
        <i class="fas fa-lock text-blue-500"></i>
        <span>پرداخت امن</span>
       </div>
      </div>
     </div>
    </div>
    <div class="border-t border-gray-700 mt-8 pt-8 text-center">
     <p class="text-gray-400">© 2024 الماس شرق. تمامی حقوق محفوظ است.</p>
    </div>
   </div>
  </footer>

  <!-- Admin Login Modal -->
  <div id="admin-login-modal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-xl p-8 w-full max-w-md mx-4">
    <div class="text-center mb-6">
     <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
      <i class="fas fa-lock text-2xl text-white"></i>
     </div>
     <h2 class="text-2xl font-bold text-gray-800">ورود به پنل مدیریت</h2>
     <p class="text-gray-600 mt-2">لطفا اطلاعات مدیریت را وارد کنید</p>
    </div>
    <form id="admin-login-form" class="space-y-4" onsubmit="adminLogin(event)">
     <div>
      <label class="block text-sm font-bold text-gray-700 mb-2">نام کاربری</label>
      <input type="text" id="admin-username" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="نام کاربری مدیر" required>
     </div>
     <div>
      <label class="block text-sm font-bold text-gray-700 mb-2">رمز عبور</label>
      <input type="password" id="admin-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="رمز عبور مدیر" required>
     </div>
     <div id="admin-login-error" class="text-red-600 text-sm hidden"></div>
     <button type="submit" id="admin-login-btn" class="w-full btn-primary text-white py-3 rounded-lg font-bold flex items-center justify-center">
      <span class="loading-spinner hidden ml-2"></span> ورود به پنل
     </button>
    </form>
    <div class="flex justify-center mt-4">
     <button id="close-admin-login" class="text-gray-500 hover:text-gray-700 font-bold" onclick="closeAdminLogin()">انصراف</button>
    </div>
   </div>
  </div>

  <!-- Admin Panel Modal -->
  <div id="admin-modal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-xl p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto mx-4">
    <div class="admin-panel text-white p-6 rounded-lg mb-6">
     <h2 class="text-3xl font-bold mb-2"><i class="fas fa-cogs ml-2"></i> پنل مدیریت فروشگاه</h2>
     <p class="opacity-90">مدیریت کامل محصولات و تنظیمات فروشگاه</p>
    </div>

    <!-- Add Product Form -->
    <div class="bg-gray-50 p-6 rounded-lg mb-6">
     <h3 class="text-xl font-bold mb-6 text-gray-800"><i class="fas fa-plus-circle text-green-500 ml-2"></i> افزودن محصول جدید</h3>
     <form id="add-product-form" class="grid grid-cols-1 md:grid-cols-2 gap-6" onsubmit="addProduct(event)">
      <div>
       <label class="block text-sm font-bold text-gray-700 mb-2">نام محصول *</label>
       <input type="text" id="product-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="نام محصول را وارد کنید" required>
      </div>
      <div>
       <label class="block text-sm font-bold text-gray-700 mb-2">قیمت پایه (تومان) *</label>
       <input type="number" id="product-price" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="قیمت پایه محصول" required>
      </div>
      <div>
       <label class="block text-sm font-bold text-gray-700 mb-2">دسته‌بندی *</label>
       <select id="product-category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" required>
        <option value="">انتخاب دسته‌بندی</option>
        <option value="لباس">لباس</option>
        <option value="آرایش">لوازم آرایش</option>
        <option value="مراقبت">مراقبت پوست</option>
        <option value="عطر">عطر و ادکلن</option>
       </select>
      </div>
      <div>
       <label class="block text-sm font-bold text-gray-700 mb-2">تصاویر محصول (لینک‌ها با کاما جدا شوند)</label>
       <input type="text" id="product-images" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg">
      </div>
      <div>
       <label class="block text-sm font-bold text-gray-700 mb-2">رنگ‌های موجود (با کاما جدا شوند)</label>
       <input type="text" id="product-colors" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="قرمز, آبی, سبز">
      </div>
      <div>
       <label class="block text-sm font-bold text-gray-700 mb-2">سایزهای موجود (با کاما جدا شوند)</label>
       <input type="text" id="product-sizes" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="S, M, L, XL">
      </div>
      <div class="md:col-span-2">
       <label class="block text-sm font-bold text-gray-700 mb-2">توضیحات محصول</label>
       <textarea id="product-description" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" rows="3" placeholder="توضیحات کامل محصول را وارد کنید"></textarea>
      </div>
      <div class="flex items-center">
       <input type="checkbox" id="product-stock" class="ml-2 w-4 h-4 text-orange-600 rounded focus:ring-orange-500" checked>
       <label for="product-stock" class="text-sm font-bold text-gray-700">موجود در انبار</label>
      </div>
      <div class="flex justify-end">
       <button type="submit" id="add-product-btn" class="btn-primary text-white px-8 py-3 rounded-lg font-bold flex items-center">
        <span class="loading-spinner hidden ml-2"></span>
        <i class="fas fa-plus ml-2"></i> افزودن محصول
       </button>
      </div>
     </form>
    </div>

    <!-- Products Management -->
    <div class="bg-gray-50 p-6 rounded-lg mb-6">
     <h3 class="text-xl font-bold mb-6 text-gray-800"><i class="fas fa-list text-blue-500 ml-2"></i> مدیریت محصولات موجود</h3>
     <div id="admin-products-list" class="space-y-4">
      <!-- Admin products will be loaded here -->
     </div>
    </div>

    <div class="flex justify-between">
     <button id="admin-logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-bold" onclick="adminLogout()">
      <i class="fas fa-sign-out-alt ml-2"></i> خروج از حساب
     </button>
     <button id="close-admin" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-bold" onclick="closeAdminPanel()">
      <i class="fas fa-times ml-2"></i> بستن
     </button>
    </div>
   </div>
  </div>

  <!-- Product Detail Modal -->
  <div id="product-modal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto mx-4">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
     <!-- Product Image -->
     <div>
      <img id="modal-product-image" src="" alt="" class="w-full h-96 object-cover rounded-lg mb-4">
     </div>
     <!-- Product Info -->
     <div>
      <h1 id="modal-product-name" class="text-3xl font-bold text-gray-800 mb-4"></h1>
      <div class="mb-4">
       <span id="modal-product-price" class="text-3xl font-bold text-orange-600"></span>
       <span class="text-gray-600 mr-2">تومان</span>
      </div>
      <p id="modal-product-description" class="text-gray-600 mb-6 leading-relaxed"></p>
      <!-- Colors -->
      <div id="color-selection" class="mb-6 hidden">
       <h4 class="font-bold mb-3">انتخاب رنگ:</h4>
       <div id="color-options" class="flex gap-3">
        <!-- Color options will be loaded here -->
       </div>
      </div>
      <!-- Sizes -->
      <div id="size-selection" class="mb-6 hidden">
       <h4 class="font-bold mb-3">انتخاب سایز:</h4>
       <div id="size-options" class="flex gap-3">
        <!-- Size options will be loaded here -->
       </div>
      </div>
      <!-- Quantity -->
      <div class="mb-6">
       <h4 class="font-bold mb-3">تعداد:</h4>
       <div class="flex items-center gap-3">
        <button class="w-10 h-10 bg-gray-200 rounded-lg font-bold" onclick="changeQuantity(-1)">-</button>
        <input type="number" id="product-quantity" class="w-20 h-10 text-center border border-gray-300 rounded-lg" value="1" min="1" max="10">
        <button class="w-10 h-10 bg-gray-200 rounded-lg font-bold" onclick="changeQuantity(1)">+</button>
       </div>
      </div>
      <!-- Action Buttons -->
      <div class="space-y-3">
       <button id="add-to-cart-btn" class="w-full btn-primary text-white py-3 rounded-lg font-bold" onclick="addToCart()">
        <i class="fas fa-shopping-cart ml-2"></i> افزودن به سبد خرید
       </button>
       <button class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-bold" onclick="buyNow()">
        <i class="fas fa-bolt ml-2"></i> خرید فوری
       </button>
      </div>
      <!-- Close Button -->
      <button id="close-product-modal" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-bold mt-4" onclick="closeProductModal()">
       <i class="fas fa-times ml-2"></i> بستن
      </button>
     </div>
    </div>
   </div>
  </div>

  <!-- Cart Modal -->
  <div id="cart-modal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
   <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto mx-4">
    <div class="flex justify-between items-center mb-6">
     <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-shopping-cart text-orange-500 ml-2"></i> سبد خرید</h2>
     <button onclick="closeCartModal()" class="text-gray-500 hover:text-gray-700">
      <i class="fas fa-times text-xl"></i>
     </button>
    </div>
    <div id="cart-items" class="space-y-4 mb-6">
     <!-- Cart items will be loaded here -->
    </div>
    <div id="cart-empty" class="text-center py-12 hidden">
     <div class="text-6xl mb-4">🛒</div>
     <h3 class="text-xl font-bold text-gray-600 mb-2">سبد خرید شما خالی است</h3>
     <p class="text-gray-500">محصولاتی را به سبد خرید اضافه کنید</p>
    </div>
    <div id="cart-summary" class="border-t pt-4 hidden">
     <div class="flex justify-between items-center mb-4">
      <span class="text-lg font-bold">مجموع:</span>
      <span id="cart-total" class="text-2xl font-bold text-orange-600">0 تومان</span>
     </div>
     <button class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-bold" onclick="checkout()">
      <i class="fas fa-credit-card ml-2"></i> تسویه حساب
     </button>
    </div>
   </div>
  </div>

  <script>
    // Global Variables
    let allProducts = [];
    let filteredProducts = [];
    let currentCategory = 'all';
    let currentPage = 1;
    let productsPerPage = 8;
    let cart = [];
    let selectedProduct = null;
    let selectedColor = null;
    let selectedSize = null;
    let isAdminLoggedIn = false;

    // Data Handler for Firebase
    const dataHandler = {
        async onDataChanged() {
            try {
                allProducts = await productsAPI.getProducts();
                currentRecordCount = allProducts.length;
                updateProductCounts();
                filterProducts(currentCategory);
                loadAdminProducts();
                console.log('Products loaded:', allProducts.length);
            } catch (error) {
                console.error('Error loading products:', error);
                showToast('خطا در بارگذاری محصولات', 'error');
            }
        }
    };

    // Initialize App
    async function initializeApp() {
        try {
            await dataHandler.onDataChanged();
            console.log('Firebase app initialized successfully');
            showToast('فروشگاه با موفقیت بارگذاری شد', 'success');
        } catch (error) {
            console.error('Error initializing app:', error);
            showToast('خطا در بارگذاری برنامه', 'error');
        }
    }

    // Utility Functions
    function generateId() {
        return 'product_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function formatPrice(price) {
        return new Intl.NumberFormat('fa-IR').format(price);
    }

    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => document.body.removeChild(toast), 300);
        }, 3000);
    }

    // Product Management Functions
    async function addProduct(event) {
        event.preventDefault();
        
        const btn = document.getElementById('add-product-btn');
        const spinner = btn.querySelector('.loading-spinner');
        
        btn.disabled = true;
        spinner.classList.remove('hidden');
        
        try {
            const productData = {
                name: document.getElementById('product-name').value.trim(),
                price: document.getElementById('product-price').value,
                category: document.getElementById('product-category').value,
                images: document.getElementById('product-images').value.trim() || '',
                description: document.getElementById('product-description').value.trim() || '',
                inStock: document.getElementById('product-stock').checked,
                colors: document.getElementById('product-colors').value.trim() || '',
                sizes: document.getElementById('product-sizes').value.trim() || ''
            };
            
            // اعتبارسنجی
            if (!productData.name || !productData.price || !productData.category) {
                showToast('لطفا تمام فیلدهای اجباری (*) را پر کنید', 'error');
                return;
            }
            
            await productsAPI.addProduct(productData);
            showToast('محصول با موفقیت اضافه شد!', 'success');
            document.getElementById('add-product-form').reset();
            
            // رفرش لیست محصولات
            await dataHandler.onDataChanged();
            
        } catch (error) {
            console.error('Error adding product:', error);
            showToast(`خطا در افزودن محصول: ${error.message}`, 'error');
        } finally {
            btn.disabled = false;
            spinner.classList.add('hidden');
        }
    }

    async function deleteProduct(product) {
        try {
            await productsAPI.deleteProduct(product.id);
            showToast('محصول با موفقیت حذف شد', 'success');
            await dataHandler.onDataChanged();
        } catch (error) {
            console.error('Error deleting product:', error);
            showToast('خطا در حذف محصول', 'error');
        }
    }

    async function updateProduct(event, productId) {
        event.preventDefault();
        
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        
        const btn = document.getElementById('add-product-btn');
        const spinner = btn.querySelector('.loading-spinner');
        
        btn.disabled = true;
        if (spinner) spinner.classList.remove('hidden');
        
        try {
            const updatedProduct = {
                name: document.getElementById('product-name').value.trim(),
                price: document.getElementById('product-price').value,
                category: document.getElementById('product-category').value,
                images: document.getElementById('product-images').value.trim() || '',
                description: document.getElementById('product-description').value.trim() || '',
                inStock: document.getElementById('product-stock').checked,
                colors: document.getElementById('product-colors').value.trim() || '',
                sizes: document.getElementById('product-sizes').value.trim() || ''
            };
            
            await productsAPI.updateProduct(productId, updatedProduct);
            showToast('محصول با موفقیت به‌روزرسانی شد!', 'success');
            resetForm();
            await dataHandler.onDataChanged();
            
        } catch (error) {
            console.error('Error updating product:', error);
            showToast('خطا در به‌روزرسانی محصول', 'error');
        } finally {
            btn.disabled = false;
            if (spinner) spinner.classList.add('hidden');
        }
    }

    // Display Functions
    function updateProductCounts() {
        const totalCount = allProducts.length;
        document.getElementById('total-products').textContent = totalCount;
        document.getElementById('total-products-hero').textContent = totalCount;
        
        if (totalCount === 0) {
            document.getElementById('empty-state').classList.remove('hidden');
            document.getElementById('products-container').classList.add('hidden');
        } else {
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('products-container').classList.remove('hidden');
        }
    }

    function filterProducts(category) {
        currentCategory = category;
        
        document.querySelectorAll('.filter-chip').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.category === category) {
                btn.classList.add('active');
            }
        });
        
        if (category === 'all') {
            filteredProducts = [...allProducts];
        } else {
            filteredProducts = allProducts.filter(product => product.category === category);
        }
        
        currentPage = 1;
        displayProducts();
        updatePagination();
    }

    function displayProducts() {
        const container = document.getElementById('products-container');
        const startIndex = (currentPage - 1) * productsPerPage;
        const endIndex = startIndex + productsPerPage;
        const productsToShow = filteredProducts.slice(startIndex, endIndex);
        
        container.innerHTML = '';
        
        productsToShow.forEach(product => {
            const productCard = createProductCard(product);
            container.appendChild(productCard);
        });
    }

    function createProductCard(product) {
        const card = document.createElement('div');
        card.className = 'product-card bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300';
        
        const images = product.images ? product.images.split(',').map(img => img.trim()).filter(img => img) : [];
        const mainImage = images.length > 0 ? images[0] : 'https://via.placeholder.com/300x300?text=تصویر+محصول';
        
        card.innerHTML = `
            <div class="relative">
                <img src="${mainImage}" alt="${product.name}" class="w-full h-64 object-cover" onerror="this.src='https://via.placeholder.com/300x300?text=تصویر+محصول'">
                ${!product.inStock ? '<div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"><span class="text-white font-bold">ناموجود</span></div>' : ''}
            </div>
            <div class="p-5">
                <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2">${product.name}</h3>
                <p class="text-gray-600 text-sm mb-3 line-clamp-2">${product.description || 'توضیحات محصول'}</p>
                <div class="flex justify-between items-center mb-4">
                    <span class="text-2xl font-bold text-orange-600">${formatPrice(product.price)}</span>
                    <span class="text-gray-500">تومان</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="openProductModal('${product.id}')" class="flex-1 btn-secondary text-white py-2 rounded-lg font-bold text-sm">
                        <i class="fas fa-eye ml-1"></i>
                        مشاهده
                    </button>
                    <button onclick="quickAddToCart('${product.id}')" class="flex-1 btn-primary text-white py-2 rounded-lg font-bold text-sm" ${!product.inStock ? 'disabled' : ''}>
                        <i class="fas fa-cart-plus ml-1"></i>
                        خرید
                    </button>
                </div>
            </div>
        `;
        
        return card;
    }

    function updatePagination() {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        
        pagination.innerHTML = '';
        
        if (totalPages <= 1) return;
        
        // Previous button
        if (currentPage > 1) {
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'قبلی';
            prevBtn.onclick = () => changePage(currentPage - 1);
            pagination.appendChild(prevBtn);
        }
        
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.textContent = i;
            pageBtn.className = i === currentPage ? 'active' : '';
            pageBtn.onclick = () => changePage(i);
            pagination.appendChild(pageBtn);
        }
        
        // Next button
        if (currentPage < totalPages) {
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'بعدی';
            nextBtn.onclick = () => changePage(currentPage + 1);
            pagination.appendChild(nextBtn);
        }
    }

    function changePage(page) {
        currentPage = page;
        displayProducts();
        updatePagination();
        scrollToProducts();
    }

    // Admin Functions
    function adminLogin(event) {
        event.preventDefault();
        
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        const errorDiv = document.getElementById('admin-login-error');
        
        if (username === 'admin' && password === 'admin123') {
            isAdminLoggedIn = true;
            closeAdminLogin();
            openAdminPanel();
            showToast('با موفقیت وارد پنل مدیریت شدید', 'success');
        } else {
            errorDiv.textContent = 'نام کاربری یا رمز عبور اشتباه است';
            errorDiv.classList.remove('hidden');
        }
    }

    function loadAdminProducts() {
        const container = document.getElementById('admin-products-list');
        container.innerHTML = '';
        
        if (allProducts.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-center py-8">هیچ محصولی یافت نشد</p>';
            return;
        }
        
        allProducts.forEach(product => {
            const productDiv = document.createElement('div');
            productDiv.className = 'bg-white p-4 rounded-lg border border-gray-200 flex justify-between items-center';
            
            productDiv.innerHTML = `
                <div class="flex-1">
                    <h4 class="font-bold text-gray-800">${product.name}</h4>
                    <p class="text-gray-600">${product.category} - ${formatPrice(product.price)} تومان</p>
                    <p class="text-sm text-gray-500">${product.inStock ? 'موجود' : 'ناموجود'}</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="editProduct('${product.id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold text-sm">
                        <i class="fas fa-edit ml-1"></i>
                        ویرایش
                    </button>
                    <button onclick="confirmDeleteProduct('${product.id}')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-bold text-sm">
                        <i class="fas fa-trash ml-1"></i>
                        حذف
                    </button>
                </div>
            `;
            
            container.appendChild(productDiv);
        });
    }

    function confirmDeleteProduct(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        
        const confirmDiv = document.createElement('div');
        confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        confirmDiv.innerHTML = `
            <div class="bg-white p-6 rounded-lg max-w-md mx-4">
                <h3 class="text-lg font-bold mb-4">تأیید حذف محصول</h3>
                <p class="text-gray-600 mb-6">آیا مطمئن هستید که می‌خواهید محصول "${product.name}" را حذف کنید؟</p>
                <div class="flex gap-3">
                    <button onclick="executeDeleteProduct('${productId}'); document.body.removeChild(this.closest('.fixed'))" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-bold">
                        بله، حذف کن
                    </button>
                    <button onclick="document.body.removeChild(this.closest('.fixed'))" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded font-bold">
                        انصراف
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(confirmDiv);
    }

    function executeDeleteProduct(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (product) {
            deleteProduct(product);
        }
    }

    function editProduct(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        
        // Fill form with product data
        document.getElementById('product-name').value = product.name;
        document.getElementById('product-price').value = product.price;
        document.getElementById('product-category').value = product.category;
        document.getElementById('product-images').value = product.images || '';
        document.getElementById('product-colors').value = product.colors || '';
        document.getElementById('product-sizes').value = product.sizes || '';
        document.getElementById('product-description').value = product.description || '';
        document.getElementById('product-stock').checked = product.inStock;
        
        // Change form to edit mode
        const form = document.getElementById('add-product-form');
        const btn = document.getElementById('add-product-btn');
        
        btn.innerHTML = '<i class="fas fa-save ml-2"></i>ذخیره تغییرات';
        form.onsubmit = (e) => updateProduct(e, productId);
    }

    function resetForm() {
        const form = document.getElementById('add-product-form');
        const btn = document.getElementById('add-product-btn');
        
        form.reset();
        btn.innerHTML = '<i class="fas fa-plus ml-2"></i>افزودن محصول';
        form.onsubmit = addProduct;
    }

    // Modal Functions
    function openProductModal(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        
        selectedProduct = product;
        
        // Update modal content
        const images = product.images ? product.images.split(',').map(img => img.trim()).filter(img => img) : [];
        const mainImage = images.length > 0 ? images[0] : 'https://via.placeholder.com/400x400?text=تصویر+محصول';
        
        document.getElementById('modal-product-image').src = mainImage;
        document.getElementById('modal-product-name').textContent = product.name;
        document.getElementById('modal-product-price').textContent = formatPrice(product.price);
        document.getElementById('modal-product-description').textContent = product.description || 'توضیحات محصول';
        
        // Handle colors
        const colorSection = document.getElementById('color-selection');
        const colorOptions = document.getElementById('color-options');
        
        if (product.colors && product.colors.trim()) {
            const colors = product.colors.split(',').map(c => c.trim()).filter(c => c);
            if (colors.length > 0) {
                colorSection.classList.remove('hidden');
                colorOptions.innerHTML = '';
                colors.forEach((color, index) => {
                    const colorBtn = document.createElement('button');
                    colorBtn.className = `w-8 h-8 rounded-full border-2 border-gray-300 ${index === 0 ? 'ring-2 ring-orange-500' : ''}`;
                    colorBtn.style.backgroundColor = getColorCode(color);
                    colorBtn.title = color;
                    colorBtn.onclick = () => selectColor(color, colorBtn);
                    colorOptions.appendChild(colorBtn);
                });
                selectedColor = colors[0];
            } else {
                colorSection.classList.add('hidden');
            }
        } else {
            colorSection.classList.add('hidden');
        }
        
        // Handle sizes
        const sizeSection = document.getElementById('size-selection');
        const sizeOptions = document.getElementById('size-options');
        
        if (product.sizes && product.sizes.trim()) {
            const sizes = product.sizes.split(',').map(s => s.trim()).filter(s => s);
            if (sizes.length > 0) {
                sizeSection.classList.remove('hidden');
                sizeOptions.innerHTML = '';
                sizes.forEach((size, index) => {
                    const sizeBtn = document.createElement('button');
                    sizeBtn.className = `px-4 py-2 border-2 border-gray-300 rounded-lg font-bold ${index === 0 ? 'bg-orange-500 text-white border-orange-500' : 'bg-white text-gray-700'}`;
                    sizeBtn.textContent = size;
                    sizeBtn.onclick = () => selectSize(size, sizeBtn);
                    sizeOptions.appendChild(sizeBtn);
                });
                selectedSize = sizes[0];
            } else {
                sizeSection.classList.add('hidden');
            }
        } else {
            sizeSection.classList.add('hidden');
        }
        
        // Reset quantity
        document.getElementById('product-quantity').value = 1;
        
        // Show modal
        document.getElementById('product-modal').classList.remove('hidden');
        document.getElementById('product-modal').classList.add('flex');
    }

    function closeProductModal() {
        document.getElementById('product-modal').classList.add('hidden');
        document.getElementById('product-modal').classList.remove('flex');
        selectedProduct = null;
        selectedColor = null;
        selectedSize = null;
    }

    function getColorCode(colorName) {
        const colorMap = {
            'قرمز': '#ff0000',
            'آبی': '#0000ff',
            'سبز': '#008000',
            'زرد': '#ffff00',
            'سیاه': '#000000',
            'سفید': '#ffffff',
            'صورتی': '#ffc0cb',
            'بنفش': '#800080',
            'نارنجی': '#ffa500',
            'قهوه‌ای': '#8b4513'
        };
        return colorMap[colorName] || '#cccccc';
    }

    function selectColor(color, button) {
        selectedColor = color;
        document.querySelectorAll('#color-options button').forEach(btn => {
            btn.classList.remove('ring-2', 'ring-orange-500');
        });
        button.classList.add('ring-2', 'ring-orange-500');
    }

    function selectSize(size, button) {
        selectedSize = size;
        document.querySelectorAll('#size-options button').forEach(btn => {
            btn.className = 'px-4 py-2 border-2 border-gray-300 rounded-lg font-bold bg-white text-gray-700';
        });
        button.className = 'px-4 py-2 border-2 border-orange-500 rounded-lg font-bold bg-orange-500 text-white';
    }

    function changeQuantity(delta) {
        const input = document.getElementById('product-quantity');
        const currentValue = parseInt(input.value);
        const newValue = Math.max(1, Math.min(10, currentValue + delta));
        input.value = newValue;
    }

    // Cart Functions
    function addToCart() {
        if (!selectedProduct) return;
        
        const quantity = parseInt(document.getElementById('product-quantity').value);
        const cartItem = {
            id: selectedProduct.id,
            name: selectedProduct.name,
            price: selectedProduct.price,
            quantity: quantity,
            color: selectedColor,
            size: selectedSize,
            image: selectedProduct.images ? selectedProduct.images.split(',')[0].trim() : ''
        };
        
        // Check if item already exists in cart
        const existingItemIndex = cart.findIndex(item => 
            item.id === cartItem.id && 
            item.color === cartItem.color && 
            item.size === cartItem.size
        );
        
        if (existingItemIndex > -1) {
            cart[existingItemIndex].quantity += quantity;
        } else {
            cart.push(cartItem);
        }
        
        updateCartUI();
        showToast('محصول به سبد خرید اضافه شد', 'success');
        closeProductModal();
    }

    function quickAddToCart(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (!product || !product.inStock) return;
        
        const cartItem = {
            id: product.id,
            name: product.name,
            price: product.price,
            quantity: 1,
            color: null,
            size: null,
            image: product.images ? product.images.split(',')[0].trim() : ''
        };
        
        const existingItemIndex = cart.findIndex(item => 
            item.id === cartItem.id && 
            item.color === cartItem.color && 
            item.size === cartItem.size
        );
        
        if (existingItemIndex > -1) {
            cart[existingItemIndex].quantity += 1;
        } else {
            cart.push(cartItem);
        }
        
        updateCartUI();
        showToast('محصول به سبد خرید اضافه شد', 'success');
    }

    function updateCartUI() {
        const cartCount = document.getElementById('cart-count');
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        
        if (totalItems > 0) {
            cartCount.textContent = totalItems;
            cartCount.classList.remove('hidden');
        } else {
            cartCount.classList.add('hidden');
        }
    }

    function openCartModal() {
        loadCartItems();
        document.getElementById('cart-modal').classList.remove('hidden');
        document.getElementById('cart-modal').classList.add('flex');
    }

    function closeCartModal() {
        document.getElementById('cart-modal').classList.add('hidden');
        document.getElementById('cart-modal').classList.remove('flex');
    }

    function loadCartItems() {
        const cartItems = document.getElementById('cart-items');
        const cartEmpty = document.getElementById('cart-empty');
        const cartSummary = document.getElementById('cart-summary');
        
        if (cart.length === 0) {
            cartItems.classList.add('hidden');
            cartSummary.classList.add('hidden');
            cartEmpty.classList.remove('hidden');
            return;
        }
        
        cartEmpty.classList.add('hidden');
        cartItems.classList.remove('hidden');
        cartSummary.classList.remove('hidden');
        
        cartItems.innerHTML = '';
        let total = 0;
        
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'flex items-center gap-4 p-4 border border-gray-200 rounded-lg';
            
            itemDiv.innerHTML = `
                <img src="${item.image || 'https://via.placeholder.com/80x80?text=تصویر'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg" onerror="this.src='https://via.placeholder.com/80x80?text=تصویر'">
                <div class="flex-1">
                    <h4 class="font-bold text-gray-800">${item.name}</h4>
                    <p class="text-sm text-gray-600">
                        ${item.color ? `رنگ: ${item.color}` : ''} 
                        ${item.size ? `سایز: ${item.size}` : ''}
                    </p>
                    <p class="text-orange-600 font-bold">${formatPrice(item.price)} تومان</p>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="changeCartItemQuantity(${index}, -1)" class="w-8 h-8 bg-gray-200 rounded font-bold">-</button>
                    <span class="w-8 text-center font-bold">${item.quantity}</span>
                    <button onclick="changeCartItemQuantity(${index}, 1)" class="w-8 h-8 bg-gray-200 rounded font-bold">+</button>
                </div>
                <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            
            cartItems.appendChild(itemDiv);
        });
        
        document.getElementById('cart-total').textContent = formatPrice(total) + ' تومان';
    }

    function changeCartItemQuantity(index, delta) {
        if (index < 0 || index >= cart.length) return;
        
        cart[index].quantity += delta;
        
        if (cart[index].quantity <= 0) {
            cart.splice(index, 1);
        }
        
        updateCartUI();
        loadCartItems();
    }

    function removeFromCart(index) {
        if (index < 0 || index >= cart.length) return;
        
        cart.splice(index, 1);
        updateCartUI();
        loadCartItems();
        showToast('محصول از سبد خرید حذف شد', 'success');
    }

    function buyNow() {
        addToCart();
        checkout();
    }

    function checkout() {
        if (cart.length === 0) {
            showToast('سبد خرید شما خالی است', 'error');
            return;
        }
        
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        showToast(`مجموع خرید: ${formatPrice(total)} تومان - این یک نمونه آزمایشی است`, 'success');
        
        // Clear cart after checkout
        cart = [];
        updateCartUI();
        closeCartModal();
    }

    // Admin Panel Functions
    function openAdminLogin() {
        document.getElementById('admin-login-modal').classList.remove('hidden');
        document.getElementById('admin-login-modal').classList.add('flex');
    }

    function closeAdminLogin() {
        document.getElementById('admin-login-modal').classList.add('hidden');
        document.getElementById('admin-login-modal').classList.remove('flex');
        document.getElementById('admin-login-form').reset();
        document.getElementById('admin-login-error').classList.add('hidden');
    }

    function openAdminPanel() {
        loadAdminProducts();
        document.getElementById('admin-modal').classList.remove('hidden');
        document.getElementById('admin-modal').classList.add('flex');
    }

    function closeAdminPanel() {
        document.getElementById('admin-modal').classList.add('hidden');
        document.getElementById('admin-modal').classList.remove('flex');
        resetForm();
    }

    function adminLogout() {
        isAdminLoggedIn = false;
        closeAdminPanel();
        showToast('از پنل مدیریت خارج شدید', 'success');
    }

    // Utility Functions
    function scrollToProducts() {
        document.getElementById('products-section').scrollIntoView({ behavior: 'smooth' });
    }

    function closeNotificationBar() {
        document.getElementById('notification-bar').style.display = 'none';
    }

    function updateURL(section) {
        window.history.pushState({}, '', `#${section}`);
    }

    function subscribeNewsletter(event) {
        event.preventDefault();
        const email = event.target.querySelector('input[type="email"]').value;
        showToast(`با موفقیت در خبرنامه عضو شدید: ${email}`, 'success');
        event.target.reset();
    }

    async function submitFeedback(event) {
        event.preventDefault();
        
        const btn = document.getElementById('feedback-btn');
        const spinner = btn.querySelector('.loading-spinner');
        const name = document.getElementById('feedback-name').value;
        const message = document.getElementById('feedback-message').value;
        
        btn.disabled = true;
        spinner.classList.remove('hidden');
        
        try {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            showToast(`نظر شما ثبت شد. متشکریم ${name}!`, 'success');
            document.getElementById('feedback-form').reset();
        } catch (error) {
            showToast('خطا در ارسال نظر', 'error');
        } finally {
            btn.disabled = false;
            spinner.classList.add('hidden');
        }
    }

    // Countdown Timer
    function updateCountdown() {
        const hours = document.getElementById('hours');
        const minutes = document.getElementById('minutes');
        const seconds = document.getElementById('seconds');
        
        let h = parseInt(hours.textContent);
        let m = parseInt(minutes.textContent);
        let s = parseInt(seconds.textContent);
        
        s--;
        if (s < 0) {
            s = 59;
            m--;
            if (m < 0) {
                m = 59;
                h--;
                if (h < 0) {
                    h = 23;
                }
            }
        }
        
        hours.textContent = h.toString().padStart(2, '0');
        minutes.textContent = m.toString().padStart(2, '0');
        seconds.textContent = s.toString().padStart(2, '0');
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        initializeApp();
        
        document.getElementById('admin-btn').addEventListener('click', function() {
            if (isAdminLoggedIn) {
                openAdminPanel();
            } else {
                openAdminLogin();
            }
        });
        
        document.getElementById('cart-btn').addEventListener('click', openCartModal);
        
        setInterval(updateCountdown, 1000);
        
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            if (query.length > 0) {
                const results = allProducts.filter(product => 
                    product.name.toLowerCase().includes(query) ||
                    product.description.toLowerCase().includes(query) ||
                    product.category.toLowerCase().includes(query)
                );
                showSearchResults(results);
            } else {
                hideSearchResults();
            }
        });
        
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                hideSearchResults();
            }
        });
    });

    function showSearchResults(results) {
        const searchResults = document.getElementById('search-results');
        searchResults.innerHTML = '';
        
        if (results.length === 0) {
            searchResults.innerHTML = '<div class="p-4 text-gray-500">محصولی یافت نشد</div>';
        } else {
            results.slice(0, 5).forEach(product => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.innerHTML = `
                    <div class="flex items-center gap-3">
                        <img src="${product.images ? product.images.split(',')[0].trim() : 'https://via.placeholder.com/40x40'}" alt="${product.name}" class="w-10 h-10 object-cover rounded" onerror="this.src='https://via.placeholder.com/40x40'">
                        <div>
                            <div class="font-bold text-sm">${product.name}</div>
                            <div class="text-xs text-gray-500">${formatPrice(product.price)} تومان</div>
                        </div>
                    </div>
                `;
                resultItem.onclick = () => {
                    openProductModal(product.id);
                    hideSearchResults();
                    document.getElementById('search-input').value = '';
                };
                searchResults.appendChild(resultItem);
            });
        }
        
        searchResults.classList.remove('hidden');
    }

    function hideSearchResults() {
        document.getElementById('search-results').classList.add('hidden');
    }
  </script>
 </body>
</html>